<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>程序编辑</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/header.css">
    <link rel="stylesheet" href="./css/edit.css">

    <script src="./js/jquery-3.7.1-min.js"></script>
    <script src="./js/vue.min.js"></script>
    <script src="./js/program.js"></script>
    <script src="./js/edit.js"></script>

</head>

<body>
    <header>
        <ul>
            <li><a href="index.html"><img src="./img/arrow-undo-outline.svg" alt="返回"></a></li>
            <li>
                <p>editing</p>
            </li>
            <li><a href="#"><img src="./img/grid-outline.svg" alt="列表"></a></li>
        </ul>
    </header>
    <div class="eg-div nav">
        <div>
            <button>动作</button>
            <!-- <button onclick="copy(1)">等待信号</button> -->
            <button onclick="copy(2)" style="width: auto;">等待释放</button>
            <button>延迟</button>
            <button>输出</button>
        </div>
        <div>
            <button>删除</button>
            <button>提交</button>
            <button>运行</button>
            <button>读取</button>
        </div>
    </div>
    <!-- 用于撑开大小 后面添加的步骤 不会从顶部开始 -->
    <div class="empty"></div>
    <!-- ---------预设的各个可复制模块----------- -->
    <div class="step eg-div action" style="display: none;">
    </div>
    <div class="step eg-div kind1" style="display: none;">等待信号</div>
    <div class="step eg-div wait" style="display: none;">等待释放</div>
    <div class="step eg-div delay" style="display: none;">延迟</div>
    <div class="step eg-div output" style="display: none;">输出成功</div>
    <!-- -------------------------------------- -->


    <div id="program">
    </div>

    <div class="sidebar">
        <button class="close">❌</button>
        <button onclick="copy(4,'SO01')">SO01(夹紧完成)</button>
        <button onclick="copy(4,'SO02')">SO02(夹紧完成)</button>
        <button onclick="copy(4,'SO03')">SO03</button>
        <button onclick="copy(4,'SO04')">SO04</button>
        <button onclick="copy(4,'SO05')">SO05</button>
        <button onclick="copy(4,'SO06')">SO06</button>
    </div>
</body>

<script>
    // 定义变量
    var msg = "eg";
    var steps = 0;
    var settings = "";

    function copy(i, msg) {
        // 找到第i个class为action的div元素
        let $target = $('.step').eq(i);
        // 克隆这个div元素
        let $clone = $target.clone();
        // 将克隆的step调为可见
        $clone.css("display", "flex");
        // 如果msg参数存在，则设置克隆元素的文本内容
        if (msg) {
            $clone.text(msg);
        }
        // 添加事件监听
        $clone.click(function () {
            $("#program").find('.selected').not(this).removeClass("selected");

            // 首先检查点击事件是否发生在按钮上
            if ($(this).hasClass("action")) {
                // 获取点击事件的目标元素
                const clickTarget = $(event.target);

                // 检查目标元素是否是 $(this) 下的按钮
                if (clickTarget.closest($(this)).length > 0 && clickTarget.is('button')) {
                    // 如果是 $(this) 下的按钮，不执行任何操作
                } else {
                    // 如果是 $(this) 下的其他元素或按钮之外的部分，执行 toggleClass
                    $(this).toggleClass("selected");
                }
            } else {
                // 如果没有找到按钮，直接执行 toggleClass
                $(this).toggleClass("selected");
            }
        });

        // 检查是否有class为step的div具有selected样式
        if ($('#program .selected').length > 0) {
            // 如果有，将克隆的div元素添加到具有selected样式的div之后
            $('.selected').after($clone);
        } else {
            // 如果没有，将克隆的div元素添加到#program的末尾
            $('#program').append($clone);
        }
        // 步骤数+1
        steps = steps + 1;
        return $clone
    }
    function func1() {
        const clickedButton = $(event.target);
        clickedButton.parent().find('button').removeClass('select');
        clickedButton.addClass('select');
    }
    // action-bar栏的前两个按钮
    function func2() {
        const clickedButton = $(event.target);
        clickedButton.parent().find('button').removeClass('select');
        clickedButton.addClass('select');

        // 将第三个按钮内容改回外部编码
        clickedButton.parent().find('button:eq(2)').text("外部编码");
    }

    // 外部编程按钮的函数
    function func3() {
        const clickedButton = $(event.target);
        clickedButton.parent().find('button').removeClass('select');
        clickedButton.addClass('select');

        // 弹出输入框
        const inputValue = prompt("请输入外部编码值:C+");

        // 如果用户点击了取消按钮或者未输入任何内容，则不进行替换操作
        if (inputValue !== null && inputValue !== "") {
            // 将按钮的文本内容替换为用户输入的值
            clickedButton.text("C" + inputValue);
        }
    }
</script>

</html>